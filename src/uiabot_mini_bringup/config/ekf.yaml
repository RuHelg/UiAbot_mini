### ekf config file ### copied and modified from robot_localization tutorial
ekf_filter_node:
    ros__parameters:
        frequency: 30.0     # Update frequency of the filter (in Hz)
        sensor_timeout: 2.0 # Increased from 0.1 to handle intermittent IMU data
        two_d_mode: true    # If true, z, roll, and pitch are ignored
        
        # Reject sensor messages with invalid covariances
        reject_invalid_sensor_data: true

        map_frame: map
        odom_frame: odom
        base_link_frame: base_link

        odom0: /wheel_encoder_odometry
        odom0_config: [false, false, false, # x, y, z
                       false, false, false, # roll, pitch, yaw
                       true,  false, false, # vx, vy, vz
                       false, false, true,  # vroll, vpitch, vyaw
                       false, false, false] # ax, ay, az
        
        odom0_queue_size: 2 # For high-frequency data or a low frequency parameter value,
                            # then you may want to increase
                            # the size of the subscription queue so that more measurements are fused.
        
        odom0_differential: false # If true, the filter will compute velocity from position data

        imu0: /bno055/imu
        imu0_config: [false, false, false, # x, y, z
                      false, false, true,  # roll, pitch, yaw
                      false, false, false, # vx, vy, vz,
                      false, false, true,  # vroll, vpitch, vyaw
                      false, false, false] # ax, ay, az - DISABLED to prevent drift
        
        imu0_differential: false # If true, the filter will compute angular velocity from orientation data
        imu0_queue_size: 5
        imu0_remove_gravitational_acceleration: true


        # Process noise covariance (15 elements flattened diagonal)
        process_noise_covariance: [0.05,  0.05, 0.1,    # x, y, z
                                    0.1,  0.1,  0.2,    # roll, pitch, yaw
                                    0.1,  0.1,  0.1,    # vx, vy, vz
                                    0.1,  0.1,  0.2,    # vroll, vpitch, vyaw
                                    0.5,  0.5,  0.5     # ax, ay, az
                                    ]

        # Initial estimate covariance (start conservative / uncertain)
        initial_estimate_covariance: [1.0, 1.0, 1.0,
                                      1.0, 1.0, 1.0,
                                      1.0, 1.0, 1.0,
                                      1.0, 1.0, 1.0,
                                      1.0, 1.0, 1.0
                                        ]
        
        
        
        
        # # [ADVANCED] The process noise covariance matrix can be difficult to tune, and can vary for each application, so it is
        # # exposed as a configuration parameter. This matrix represents the noise we add to the total error after each
        # # prediction step. The better the omnidirectional motion model matches your system, the smaller these values can be.
        # # However, if users find that a given variable is slow to converge, one approach is to increase the
        # # process_noise_covariance diagonal value for the variable in question, which will cause the filter's predicted error
        # # to be larger, which will cause the filter to trust the incoming measurement more during correction. The values are
        # # ordered as x, y, z, roll, pitch, yaw, vx, vy, vz, vroll, vpitch, vyaw, ax, ay, az. Defaults to the matrix below if
        # # unspecified.
        # # Note: the specification of covariance matrices can be cumbersome, so all matrix parameters in this package support
        # # both full specification or specification of only the diagonal values.
        # process_noise_covariance: [0.05, 0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.05, 0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.06, 0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.03, 0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.03, 0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.06, 0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.025, 0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.025, 0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.04, 0.0,    0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.01, 0.0,    0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.01, 0.0,    0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.02, 0.0,    0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.01, 0.0,    0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.01, 0.0,
        #                            0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.0,     0.0,     0.0,    0.0,    0.0,    0.0,    0.0,    0.0,    0.015]

        # # [ADVANCED] This represents the initial value for the state estimate error covariance matrix. Setting a diagonal
        # # value (variance) to a large value will result in rapid convergence for initial measurements of the variable in
        # # question. Users should take care not to use large values for variables that will not be measured directly. The values
        # # are ordered as x, y, z, roll, pitch, yaw, vx, vy, vz, vroll, vpitch, vyaw, ax, ay, az. Defaults to the diagonal values below
        # # if unspecified. In this example, we specify only the diagonal of the matrix.
        # initial_estimate_covariance: [1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9]

